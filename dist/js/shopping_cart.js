"use strict";$(function(){function t(){$.ajax({type:"post",url:"../api/shoppingCart.php",data:{uid:cookie.get("uid")},success:function(e){var a=JSON.parse(e);console.log(a),1==a.code?(!function(e){var a=e.map(function(e){return'<tr data-id="'+e.deleid+'">                        <td><input class="check" type="checkbox" /></td>                        <td class="xinxi">                            <img src="../img/'+e.img_min2+'" alt="" />                            <a href="javascript:;"><span>'+e.title+'</span></a>                        </td>                        <td>                            <p class="jiage">¥'+e.price+'</p>                            <p class="fanhui">返现¥100.00</p>                        </td>                        <td class="shuliang">                            <input type="text" value="'+e.nums+'" />                            <span>                                <span class="num_add"></span>                                <span class="num_minus"></span>                            </span>                        </td>                        <td>                            <p class="xiaoji">¥3799.00</p>                        </td>                        <td class="caozuo">                            <a class="dele" href="javascript:;">删除</a>                            <a href="javascript:;">移入收藏夹</a>                        </td>                    </tr>'}).join("");$(".message").html(a);for(var t=0;t<$(".xiaoji").size();t++)s($(".num_add").eq(t))}(a.datalist),n(),$(".commodity_deal").css("display","inlineBlock"),$(".commodity_add").css("display","none")):2==a.code&&($(".commodity_deal").css("display","none"),$(".commodity_add").css("display","block"))}})}function e(e,t){var a=t.parent().parent().parent().attr("data-id"),c=t.parent().prev();$.ajax({type:"get",url:"../api/add_sub.php",data:{deleid:a,type:e},success:function(e){var a=JSON.parse(e);console.log(a),c.val(a.num),0==a.code&&alert(a.message),s(t),n()}})}function s(e){var a=e.parent().parent().prev().children().html().slice(1),t=e.parent().prev().val(),c=(a*t).toFixed(2);console.log(a,t,c),e.parent().parent().next().children().html("¥"+c)}t(),$(".message").on("click",".num_add",function(){e("add",$(this))}),$(".message").on("click",".num_minus",function(){e("sud",$(this))}),$(".message").on("click",".dele",function(){var e=$(this).parent().parent().attr("data-id");confirm("确定删除吗？")&&$.ajax({type:"get",url:"../api/delete.php",data:{deleid:e},success:function(e){var a=JSON.parse(e);console.log(a),a.code&&t()}})}),$(".message").on("click",".check",function(){n()});var c=[];function n(){c=[];for(var e=0;e<$(".check").size();e++)$(".check").eq(e).prop("checked")&&c.push(e);c.length==$(".check").size()?$(".header input").prop("checked","checked"):$(".header input").removeAttr("checked"),c.length<1?($(".sun_total").parent().css("display","none"),$(".sun_total").parent().next().css("background","#767676")):($(".sun_total").parent().css("display","block"),$(".sun_total").parent().next().css("background","#F7661F"));var a=0;for(e=0;e<c.length;e++)a+=1*$(".xiaoji").eq(c[e]).html().substring(1);$(".sun_total").html("¥"+a.toFixed(2))}$(".header input").on("click",function(){$(this).prop("checked")?$(".check").prop("checked","checked"):$(".check").removeAttr("checked"),n()})});